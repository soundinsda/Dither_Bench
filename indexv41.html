<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Audio Player – Lógica Completa con Conmutación Automática</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 20px;
    }
    h1 {
      font-size: 30px;
      color: #333;
      margin-bottom: 10px;
      margin-top: 10px; /* Ajusta la posición vertical */
      margin-left: 10px; /* Ajusta la posición horizontal */
      text-align: center;
    }
    .row {
      display: flex;
      flex-direction: row;
      justify-content: center;
      gap: 10px;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    #main-row {
      margin-top: 30px;
      position: relative;
      width: 100%;
      max-width: 1160px; /* Ancho total de la tabla (116px * 10 columnas) */
    }
    .source-group {
      display: flex;
      flex-direction: row;
      align-items: center;
      position: absolute;
      left: 116px; /* Alineado con el inicio de la columna 1 */
      top: 0;
    }
    .source-label {
      font-size: 14px;
      color: #333;
      margin-right: 10px;
      white-space: nowrap;
      align-self: center;
    }
    .vertical-line {
      width: 2px;
      height: 45px; /* Altura de ambos botones (20px + 20px) + gap (5px) */
      background-color: #333;
      margin-right: 10px;
    }
    .toggle-source {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    #rect-24bits {
      position: absolute;
      left: 464px; /* Columna 6 (580px) + desplazamiento leve de 10px */
    }
    #rect-main {
      position: absolute;
      left: 590px; /* Columna 5 (116px * 4) */
	top= 10px;
    }
    #toggle-btn {
      position: absolute;
      left: 716px; /* A la derecha de rect-24bits (590px + 116px + 10px de espacio) */
	top: 10px;    
}
    table {
      border-collapse: separate;
      margin-top: 40px;
      border-spacing: 0;
      width: 100%;
      max-width: 1160px; /* Ancho total de las 10 columnas */
      position: relative; /* Añadido para permitir desplazamiento */
      top: 80px; /* Desplazamiento solo hacia abajo */
      /* left: 0; No se aplica desplazamiento horizontal */
    }
    th, td {
      padding: 10px;
      width: 116px;
      text-align: center;
      vertical-align: top;
    }
    th {
      font-weight: bold;
      font-size: 14px;
      color: #333;
      position: relative;
      padding: 5px 10px;
    }
    th::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 10px;
      width: calc(100% - 20px);
      height: 2px;
      background-color: #333;
    }
    th:not(:last-child)::after {
      margin-right: 10px;
    }
    .rect {
      width: 100px;
      padding: 8px;
      border-radius: 10px;
      background-color: blue;
      color: white;
      text-align: center;
      cursor: pointer;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      line-height: 1.2;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      transition: all 0.2s ease;
      margin: 5px auto;
    }
    .rect.no-data {
      visibility: hidden;
    }
    .rect:hover {
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    .rect:active {
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
      transform: scale(0.98);
    }
    .rect.green {
      background-color: green;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    .rect.green:active {
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
      transform: scale(0.98);
    }
    .progress-container {
      width: 100px;
      height: 4px;
      background-color: #ddd;
      border-radius: 5px;
      overflow: hidden;
      position: absolute;
      bottom: -15px;
      left: 8px;
    }
    .rect.no-data .progress-container {
      visibility: hidden;
    }
    .loading-bar {
      width: 0;
      height: 100%;
      background-color: #4caf50;
      transition: width 0.3s;
    }
    #toggle-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: green;
      color: white;
      font-weight: bold;
      border: none;
      outline: none;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      transition: all 0.2s ease;
      font-size: 10px;
    }
    #toggle-btn:hover {
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    #toggle-btn:active {
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
      transform: scale(0.95);
    }
    #toggle-btn.disabled {
      background-color: red;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    #toggle-btn.disabled:active {
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
      transform: scale(0.95);
    }
    #pause-btn {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: red;
      border: none;
      outline: none;
      cursor: pointer;
      margin-top: 100px;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black"><rect x="6" y="6" width="12" height="12" /></svg>');
      background-size: 60%;
      background-repeat: no-repeat;
      background-position: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      transition: all 0.2s ease;
    }
    #pause-btn:hover {
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    #pause-btn:active {
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
      transform: scale(0.95);
    }
    #rect-main {
      height: 20px;
    }
    #rect-24bits {
      height: 20px;
    }
    .source-btn {
      width: 80px;
      height: 20px;
      background-color: #1a73e8;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      transition: all 0.2s ease;
    }
    .source-btn.active {
      background-color: green;
    }
  </style>
</head>
<body>
  <h1>Dither & NS Benchmark</h1>
  <div id="main-row" class="row">
    <div class="source-group">
      <span class="source-label">Source</span>
      <div class="vertical-line"></div>
      <div class="toggle-source">
        <div class="rect source-btn active" id="source-Sine">Sine</div>
        <div class="rect source-btn" id="source-flaute">Flaute</div>
      </div>
    </div>
    <div class="rect" id="rect-24bits">24 bits
      <div class="progress-container"><div class="loading-bar" id="loading-bar-24bits"></div></div>
    </div>
    <div class="rect" id="rect-main">16 bits No Dither
      <div class="progress-container"><div class="loading-bar" id="loading-bar-main"></div></div>
    </div>
    <button id="toggle-btn">997Hz</button>
  </div>
  <table>
    <thead>
      <tr>
        <th colspan="2">Izotope</th>
        <th>FabFilter</th>
        <th colspan="2">Waves</th>
        <th>Voxengo</th>
        <th>DMG</th>
        <th colspan="3">DAW</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><div class="rect" id="rect-1">Ozone 11<br>Dither: Low<br>NS: Off
          <div class="progress-container"><div class="loading-bar" id="loading-bar-1"></div></div></div></td>
        <td><div class="rect" id="rect-2">Ozone 11<br>Dither: High<br>NS: Off
          <div class="progress-container"><div class="loading-bar" id="loading-bar-2"></div></div></div></td>
        <td><div class="rect" id="rect-3">Pro L2<br>Dither: On<br>NS: Off
          <div class="progress-container"><div class="loading-bar" id="loading-bar-3"></div></div></div></td>
        <td><div class="rect" id="rect-4">L2<br>Dither: T1<br>NS: Off
          <div class="progress-container"><div class="loading-bar" id="loading-bar-4"></div></div></div></td>
        <td><div class="rect" id="rect-5">L2<br>Dither: T2<br>NS: Off
          <div class="progress-container"><div class="loading-bar" id="loading-bar-5"></div></div></div></td>
        <td><div class="rect" id="rect-6">Elephant<br>Dither: TPDF<br>NS: Off
          <div class="progress-container"><div class="loading-bar" id="loading-bar-6"></div></div></div></td>
        <td><div class="rect" id="rect-7">Limitless<br>Dither: On<br>NS: Off
          <div class="progress-container"><div class="loading-bar" id="loading-bar-7"></div></div></div></td>
        <td><div class="rect" id="rect-8">Reaper<br>Dither: On<br>NS: Off
          <div class="progress-container"><div class="loading-bar" id="loading-bar-8"></div></div></div></td>
        <td><div class="rect" id="rect-9">Live<br>Dither: TPDF<br>NS: Off
          <div class="progress-container"><div class="loading-bar" id="loading-bar-9"></div></div></div></td>
        <td><div class="rect" id="rect-10">ProTools<br>Dither: On<br>NS: Off
          <div class="progress-container"><div class="loading-bar" id="loading-bar-10"></div></div></div></td>
      </tr>
      <tr>
        <td><div class="rect" id="rect-11">Ozone 11<br>Dither: Low<br>NS: Low
          <div class="progress-container"><div class="loading-bar" id="loading-bar-11"></div></div></div></td>
        <td><div class="rect" id="rect-12">Ozone 11<br>Dither: High<br>NS: Low
          <div class="progress-container"><div class="loading-bar" id="loading-bar-12"></div></div></div></td>
        <td><div class="rect" id="rect-13">Pro L2<br>Dither: On<br>NS: Basic
          <div class="progress-container"><div class="loading-bar" id="loading-bar-13"></div></div></div></td>
        <td><div class="rect" id="rect-14">L2<br>Dither: T1<br>NS: Moderate
          <div class="progress-container"><div class="loading-bar" id="loading-bar-14"></div></div></div></td>
        <td><div class="rect" id="rect-15">L2<br>Dither: T2<br>NS: Moderate
          <div class="progress-container"><div class="loading-bar" id="loading-bar-15"></div></div></div></td>
        <td><div class="rect no-data" id="rect-16">No data
          <div class="progress-container"><div class="loading-bar" id="loading-bar-16"></div></div></div></td>
        <td><div class="rect" id="rect-17">Limitless<br>Dither: On<br>NS: 50%
          <div class="progress-container"><div class="loading-bar" id="loading-bar-17"></div></div></div></td>
        <td><div class="rect no-data" id="rect-18">No data
          <div class="progress-container"><div class="loading-bar" id="loading-bar-18"></div></div></div></td>
        <td><div class="rect" id="rect-19">Live<br>Dither: TPDF<br>NS: POWr1
          <div class="progress-container"><div class="loading-bar" id="loading-bar-19"></div></div></div></td>
        <td><div class="rect" id="rect-20">ProTools<br>Dither: On<br>NS: Type 1
          <div class="progress-container"><div class="loading-bar" id="loading-bar-20"></div></div></div></td>
      </tr>
      <tr>
        <td><div class="rect" id="rect-21">Ozone 11<br>Dither: Low<br>NS: Mid
          <div class="progress-container"><div class="loading-bar" id="loading-bar-21"></div></div></div></td>
        <td><div class="rect" id="rect-22">Ozone 11<br>Dither: High<br>NS: Mid
          <div class="progress-container"><div class="loading-bar" id="loading-bar-22"></div></div></div></td>
        <td><div class="rect" id="rect-23">Pro L2<br>Dither: On<br>NS: Optimized
          <div class="progress-container"><div class="loading-bar" id="loading-bar-23"></div></div></div></td>
        <td><div class="rect" id="rect-24">L2<br>Dither: T1<br>NS: Normal
          <div class="progress-container"><div class="loading-bar" id="loading-bar-24"></div></div></div></td>
        <td><div class="rect" id="rect-25">L2<br>Dither: T2<br>NS: Normal
          <div class="progress-container"><div class="loading-bar" id="loading-bar-25"></div></div></div></td>
        <td><div class="rect" id="rect-26">Elephant<br>Dither: TPDF<br>NS: Equal
          <div class="progress-container"><div class="loading-bar" id="loading-bar-26"></div></div></div></td>
        <td><div class="rect" id="rect-27">Limitless<br>Dither: On<br>NS: 100%
          <div class="progress-container"><div class="loading-bar" id="loading-bar-27"></div></div></div></td>
        <td><div class="rect no-data" id="rect-28">No data
          <div class="progress-container"><div class="loading-bar" id="loading-bar-28"></div></div></div></td>
        <td><div class="rect" id="rect-29">Live<br>Dither: TPDF<br>NS: POWr2
          <div class="progress-container"><div class="loading-bar" id="loading-bar-29"></div></div></div></td>
        <td><div class="rect" id="rect-30">ProTools<br>Dither: On<br>NS: Type 2
          <div class="progress-container"><div class="loading-bar" id="loading-bar-30"></div></div></div></td>
      </tr>
      <tr>
        <td><div class="rect" id="rect-31">Ozone 11<br>Dither: Low<br>NS: Max
          <div class="progress-container"><div class="loading-bar" id="loading-bar-31"></div></div></div></td>
        <td><div class="rect" id="rect-32">Ozone 11<br>Dither: High<br>NS: Max
          <div class="progress-container"><div class="loading-bar" id="loading-bar-32"></div></div></div></td>
        <td><div class="rect" id="rect-33">Pro L2<br>Dither: On<br>NS: Weighted
          <div class="progress-container"><div class="loading-bar" id="loading-bar-33"></div></div></div></td>
        <td><div class="rect" id="rect-34">L2<br>Dither: T1<br>NS: Ultra
          <div class="progress-container"><div class="loading-bar" id="loading-bar-34"></div></div></div></td>
        <td><div class="rect" id="rect-35">L2<br>Dither: T2<br>NS: Ultra
          <div class="progress-container"><div class="loading-bar" id="loading-bar-35"></div></div></div></td>
        <td><div class="rect" id="rect-36">Elephant<br>Dither: TPDF<br>NS: Classic
          <div class="progress-container"><div class="loading-bar" id="loading-bar-36"></div></div></div></td>
        <td><div class="rect" id="rect-37">Limitless<br>Dither: On<br>NS: 200%
          <div class="progress-container"><div class="loading-bar" id="loading-bar-37"></div></div></div></td>
        <td><div class="rect" id="rect-38">Reaper<br>Dither: On<br>NS: On
          <div class="progress-container"><div class="loading-bar" id="loading-bar-38"></div></div></div></td>
        <td><div class="rect" id="rect-39">Live<br>Dither: TPDF<br>NS: POWr3
          <div class="progress-container"><div class="loading-bar" id="loading-bar-39"></div></div></div></td>
        <td><div class="rect" id="rect-40">ProTools<br>Dither: On<br>NS: Type 3
          <div class="progress-container"><div class="loading-bar" id="loading-bar-40"></div></div></div></td>
      </tr>
    </tbody>
  </table>
  <button id="pause-btn"></button>

  <script>
    const audioMapping = {
      "rect-main": {
        "997_no": "https://raw.githubusercontent.com/soundinsda/Audio_Dither/main/Flaute_16bits_NoDither_Gain.wav",
        "997_act": "https://raw.githubusercontent.com/pablofpa/audio-player/main/16%20bits%20NoDither_wo997.wav"
      },
      "rect-1": {
        "997_no": "https://raw.githubusercontent.com/pablofpa/audio-player/main/Ozo_Low.wav",
        "997_act": "https://raw.githubusercontent.com/pablofpa/audio-player/main/Ozo_Low_wo997.wav"
      },
      "rect-2": {
        "997_no": "https://raw.githubusercontent.com/pablofpa/audio-player/main/ProL2.wav",
        "997_act": "https://raw.githubusercontent.com/pablofpa/audio-player/main/ProL2_wo997.wav"
      },
      "rect-3": {
        "997_no": "https://raw.githubusercontent.com/pablofpa/audio-player/main/L2_T1.wav",
        "997_act": "https://raw.githubusercontent.com/pablofpa/audio-player/main/L2_T1_wo99.wav"
      },
      "rect-4": {
        "997_no": "https://raw.githubusercontent.com/pablofpa/audio-player/main/L2_T2.wav",
        "997_act": "https://raw.githubusercontent.com/pablofpa/audio-player/main/L2_T2_wo997.wav"
      },
      "rect-5": {
        "997_no": "https://raw.githubusercontent.com/pablofpa/audio-player/main/Ozo_Low_High.wav",
        "997_act": "https://raw.githubusercontent.com/pablofpa/audio-player/main/Ozo_Low_High_wo997.wav"
      },
      "rect-6": {
        "997_no": "https://raw.githubusercontent.com/pablofpa/audio-player/main/ProL2_Opt.wav",
        "997_act": "https://raw.githubusercontent.com/pablofpa/audio-player/main/ProL2_Opt_wo997.wav"
      },
      "rect-7": {
        "997_no": "https://raw.githubusercontent.com/pablofpa/audio-player/main/L2_T1_Normal.wav",
        "997_act": "https://raw.githubusercontent.com/pablofpa/audio-player/main/L2_T1_Normal_wo997.wav"
      },
      "rect-8": {
        "997_no": "https://raw.githubusercontent.com/pablofpa/audio-player/main/L2_T2_Normal.wav",
        "997_act": "https://raw.githubusercontent.com/pablofpa/audio-player/main/L2_T2_Normal_wo997.wav"
      }
    };

    let isToggleEnabled = true;
    let currentActiveRect = null;
    let currentSource = "Sine"; // Estado inicial: Sine
    const audioPlayers = {};

    // Manejo de selección de fuente (Sine/Flaute)
    const sourceSine = document.getElementById("source-Sine");
    const sourceFlaute = document.getElementById("source-flaute");

    function setActiveSource(source) {
      currentSource = source;
      sourceSine.classList.toggle("active", source === "Sine");
      sourceFlaute.classList.toggle("active", source === "flaute");
      console.log(`Fuente seleccionada: ${source}`);
      // Aquí puedes añadir lógica para actualizar los audios según la fuente seleccionada
    }

    sourceSine.addEventListener("click", () => {
      setActiveSource("Sine");
    });

    sourceFlaute.addEventListener("click", () => {
      setActiveSource("flaute");
    });

    function preloadAudio(rectId, urls, loadingBar) {
      if (!urls["997_no"] || !urls["997_act"]) return;
      const audioNo = new Audio(urls["997_no"]);
      const audioAct = new Audio(urls["997_act"]);
      audioPlayers[rectId] = { no: audioNo, act: audioAct };

      function updateProgress() {
        let percentNo = audioNo.buffered.length ? (audioNo.buffered.end(0) / (audioNo.duration || 1)) * 100 : 0;
        let percentAct = audioAct.buffered.length ? (audioAct.buffered.end(0) / (audioAct.duration || 1)) * 100 : 0;
        const avgPercent = (percentNo + percentAct) / 2;
        loadingBar.style.width = `${avgPercent}%`;
      }

      audioNo.addEventListener("progress", updateProgress);
      audioAct.addEventListener("progress", updateProgress);
      audioNo.addEventListener("canplaythrough", () => console.log(`${rectId} - 997_no listo`));
      audioAct.addEventListener("canplaythrough", () => console.log(`${rectId} - 997_act listo`));
      audioNo.addEventListener("error", (e) => {
        console.error(`${rectId} - 997_no falló:`, e.target.error ? e.target.error.message : "Error desconocido");
      });
      audioAct.addEventListener("error", (e) => {
        console.error(`${rectId} - 997_act falló:`, e.target.error ? e.target.error.message : "Error desconocido");
      });

      audioNo.load();
      audioAct.load();
    }

    Object.keys(audioMapping).forEach(rectId => {
      const suffix = rectId === "rect-main" ? "main" : rectId.split("-")[1];
      const loadingBar = document.getElementById(`loading-bar-${suffix}`);
      preloadAudio(rectId, audioMapping[rectId], loadingBar);
    });

    function updateCurrentAudio() {
      if (currentActiveRect && audioPlayers[currentActiveRect]) {
        const players = audioPlayers[currentActiveRect];
        players.no.pause();
        players.act.pause();
        players.no.currentTime = 0;
        players.act.currentTime = 0;
        const stateKey = isToggleEnabled ? "no" : "act";
        const chosenAudio = players[stateKey];
        chosenAudio.currentTime = 0;
        chosenAudio.play().catch(e => console.error(`Error al reproducir ${currentActiveRect}:`, e));
      }
    }

    function stopAllAudio() {
      Object.keys(audioPlayers).forEach(rectId => {
        const players = audioPlayers[rectId];
        if (players) {
          players.no.pause();
          players.act.pause();
          players.no.currentTime = 0;
          players.act.currentTime = 0;
        }
        const rectElem = document.getElementById(rectId);
        rectElem?.classList.remove("green");
      });
      currentActiveRect = null;
    }

    function pauseCurrentAudio() {
      if (currentActiveRect && audioPlayers[currentActiveRect]) {
        const players = audioPlayers[currentActiveRect];
        players.no.pause();
        players.act.pause();
        const rectElem = document.getElementById(currentActiveRect);
        rectElem?.classList.remove("green");
        currentActiveRect = null;
        console.log("Audio pausado");
      } else {
        console.log("No hay audio reproduciéndose");
        stopAllAudio();
      }
    }

    const toggleBtn = document.getElementById("toggle-btn");
    toggleBtn.addEventListener("click", () => {
      isToggleEnabled = !isToggleEnabled;
      toggleBtn.classList.toggle("disabled", !isToggleEnabled);
      toggleBtn.style.backgroundColor = isToggleEnabled ? "green" : "red";
      updateCurrentAudio();
    });

    const pauseBtn = document.getElementById("pause-btn");
    pauseBtn.addEventListener("click", pauseCurrentAudio);

    for (let i = 1; i <= 40; i++) {
      const rectId = `rect-${i}`;
      const rectElem = document.getElementById(rectId);
      if (rectElem && !rectElem.classList.contains("no-data")) {
        rectElem.addEventListener("click", () => {
          stopAllAudio();
          currentActiveRect = rectId;
          const stateKey = isToggleEnabled ? "no" : "act";
          const chosenAudio = audioPlayers[rectId]?.[stateKey];
          if (chosenAudio) {
            chosenAudio.currentTime = 0;
            chosenAudio.play().catch(e => console.error(`Error al reproducir ${rectId}:`, e));
            rectElem.classList.add("green");
            chosenAudio.onended = () => {
              rectElem.classList.remove("green");
              currentActiveRect = null;
            };
          } else {
            console.warn(`${rectId} - No hay audio asignado`);
            rectElem.classList.add("green");
          }
        });
      }
    }
  </script>
</body>
</html>